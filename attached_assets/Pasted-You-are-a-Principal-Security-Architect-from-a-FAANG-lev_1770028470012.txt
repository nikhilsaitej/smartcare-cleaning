You are a Principal Security Architect from a FAANG-level company.

You are auditing and hardening a real, production e-commerce + services platform:
https://website-aesthetic-builder.replit.app/

Tech stack:
- Frontend: React + Vite
- Backend: Node.js (Express / Fastify)
- Database: PostgreSQL (Supabase)
- Auth: Supabase Auth (Email + OAuth)
- Payments: External gateway (money involved)
- Notifications: Email / SMS / WhatsApp
- Hosting: Replit (production)

THIS IS A REAL BUSINESS APPLICATION.
ASSUME REAL USERS, REAL ORDERS, REAL MONEY, AND LEGAL RISK.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ OBJECTIVE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Transform this application into a **bank-grade, production-ready, attack-resistant system** suitable for:
- B2C customers
- B2B clients
- Admin dashboards
- Financial transactions
- Future enterprise scaling

DO NOT optimize for speed or convenience.
OPTIMIZE STRICTLY FOR SECURITY, DATA INTEGRITY, AND ABUSE PREVENTION.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” TASK 1: FULL SECURITY AUDIT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Perform a complete audit of:
- Frontend
- Backend APIs
- Authentication & authorization
- Database access
- Payment flow
- Environment variables
- Deployment configuration

Identify:
- Critical vulnerabilities
- Medium-risk weaknesses
- Bad practices
- Missing protections
- Trust boundary violations

Classify risks as:
CRITICAL / HIGH / MEDIUM / LOW

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” TASK 2: AUTHENTICATION & AUTHORIZATION (ZERO TRUST)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Enforce **server-side authentication only**
- Never trust frontend role, userId, or permissions
- Validate Supabase JWT on EVERY request
- Implement role-based access control (RBAC):
  - user
  - admin
  - super-admin
- Lock down all admin APIs so they are:
  - Invisible to unauthenticated users
  - Impossible to access via frontend manipulation

Explicitly prevent:
- Privilege escalation
- Token reuse
- Session fixation
- OAuth misconfiguration

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ›¡ï¸ TASK 3: API SECURITY & ABUSE PREVENTION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Implement strict rate limiting:
  - Login
  - Signup
  - OTP
  - Checkout
  - Admin actions
- Add IP-based + user-based throttling
- Block brute-force, scraping, and bot traffic
- Add request fingerprinting

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ§± TASK 4: INPUT VALIDATION & INJECTION DEFENSE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Enforce strict schema validation (Zod/Joi) on EVERY API input
- Reject unknown, extra, or malformed fields
- Eliminate all raw SQL
- Use ORM safely (parameterized queries only)
- Harden against:
  - SQL Injection
  - NoSQL Injection
  - XSS
  - CSRF
  - SSRF
  - Command Injection
  - Prototype Pollution

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ—„ï¸ TASK 5: DATABASE & SUPABASE HARDENING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Implement strict Row Level Security (RLS) on ALL tables
- Ensure users can ONLY access their own data
- Ensure admin access is server-controlled
- Prevent service role key leakage
- Lock down public schema exposure
- Add audit tables for:
  - Orders
  - Payments
  - Admin actions
  - Auth events

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’³ TASK 6: PAYMENT SECURITY (NO COMPROMISE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- NEVER trust frontend pricing or order details
- Calculate all prices server-side
- Generate payment intents only from backend
- Verify payment webhooks cryptographically
- Prevent:
  - Price tampering
  - Replay attacks
  - Fake success callbacks
- Store immutable transaction records
- Implement idempotency keys

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ TASK 7: ERROR HANDLING & DATA LEAK PREVENTION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Remove stack traces from frontend
- Standardize error responses
- Log detailed errors ONLY server-side
- Prevent leaking:
  - Database structure
  - Environment variables
  - Internal logic
  - Auth flow details

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒ TASK 8: INFRASTRUCTURE & NETWORK SECURITY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Enforce HTTPS everywhere
- Add strict security headers:
  - CSP
  - HSTS
  - X-Frame-Options
  - X-Content-Type-Options
- Lock CORS to exact origins only
- Prevent clickjacking
- Prepare for WAF / CDN integration (Cloudflare-ready)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š TASK 9: LOGGING, MONITORING & INCIDENT RESPONSE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Add structured logs for:
  - Auth attempts
  - Payment events
  - Admin actions
  - Failed validations
- Add alerts for:
  - Repeated login failures
  - Payment mismatches
  - Suspicious API usage
- Ensure logs are tamper-resistant

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ˆ TASK 10: FUTURE ENTERPRISE READINESS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Design the system so it can later support:
- Microservices
- Separate auth service
- Dedicated payment service
- Redis for rate limiting & sessions
- SOC2 / ISO27001 compliance readiness

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ FINAL OUTPUT REQUIRED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Provide:
1. Exact code changes and middleware
2. Security architecture diagram (text-based)
3. Before vs After risk comparison
4. Production security checklist
5. â€œDO NOT DEPLOY IF ANY OF THESE FAILâ€ checklist

DO NOT give generic advice.
DO NOT simplify.
DO NOT skip steps.

Think like an attacker.
Build like a bank.